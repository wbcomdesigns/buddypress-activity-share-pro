($=>{class BPSharePostType{constructor(){this.wrapper=$(".bp-share-floating-wrapper"),this.isActive=!1,this.clipboard=null,this.init()}init(){this.wrapper.length&&(this.bindEvents(),this.initClipboard(),this.trackVisibility(),this.handleScrollBehavior())}bindEvents(){this.wrapper.find(".bp-share-toggle").on("click",e=>{e.preventDefault(),this.toggleWrapper()}),this.wrapper.find(".bp-share-service").on("click",e=>{var $link=$(e.currentTarget),service=$link.data("service");"copy"===service?(e.preventDefault(),$link=$link.attr("href"),this.copyLinkUrl($link)):"print"===service?(e.preventDefault(),this.printPage()):this.trackShare(service,this.wrapper.data("post-id"))}),$(document).on("click",".bp-share-button",e=>{var $button=$(e.currentTarget),service=$button.data("service");"copy"===service?(e.preventDefault(),this.copyLink(e.currentTarget)):"print"===service?(e.preventDefault(),this.printPage()):"email"!==service&&this.trackShare(service,$button.data("post-id"))}),$(document).on("click",e=>{this.isActive&&!this.wrapper.is(e.target)&&0===this.wrapper.has(e.target).length&&this.toggleWrapper(!1)}),$(document).on("keydown",e=>{"Escape"===e.key&&this.isActive&&this.toggleWrapper(!1)})}toggleWrapper(state=null){this.isActive=null!==state?state:!this.isActive,this.wrapper.toggleClass("bp-share-active",this.isActive)}copyLinkUrl(url){let postId=this.wrapper.data("post-id");navigator.clipboard?navigator.clipboard.writeText(url).then(()=>{this.showTooltip(bp_share_post_vars.copied_text),this.trackShare("copy",postId)}).catch(()=>{this.fallbackCopyLink(url)}):this.fallbackCopyLink(url)}copyLink(element){let postId=this.wrapper.data("post-id")||$(element).data("post-id"),url=$(element).attr("data-href")||$(element).attr("href");navigator.clipboard?navigator.clipboard.writeText(url).then(()=>{this.showTooltip(bp_share_post_vars.copied_text),this.trackShare("copy",postId)}).catch(()=>{this.fallbackCopyLink(url)}):this.fallbackCopyLink(url)}fallbackCopyLink(url){var $temp=$("<input>");$("body").append($temp),$temp.val(url).select(),document.execCommand("copy"),$temp.remove(),this.showTooltip(bp_share_post_vars.copied_text),this.trackShare("copy",this.wrapper.data("post-id"))}printPage(){window.print(),this.trackShare("print",this.wrapper.data("post-id"))}trackShare(service,postId){$.ajax({url:bp_share_post_vars.ajax_url,type:"POST",data:{action:"bp_share_post",service:service,post_id:postId,nonce:bp_share_post_vars.nonce},success:response=>{try{var data="string"==typeof response?JSON.parse(response):response;data.success&&void 0!==data.count?this.updateShareCount(data.count):!data.success&&data.message&&window.console&&window.console.warn&&console.warn("BuddyPress Share: "+data.message)}catch(e){window.console&&window.console.error&&console.error("BuddyPress Share: Unable to process response",e)}},error:(xhr,status,error)=>{window.console&&window.console.error&&console.error("BuddyPress Share: Network error",error)}})}updateShareCount(count){var $count=this.wrapper.find(".bp-share-count");$count.length&&($count.text(this.formatCount(count)),0<count)&&$count.is(":hidden")&&$count.fadeIn()}formatCount(count){return count<1e3?count:count<1e6?(count/1e3).toFixed(1)+"K":(count/1e6).toFixed(1)+"M"}showTooltip(message){let $tooltip=this.wrapper.find(".bp-share-tooltip");$tooltip.find(".bp-share-tooltip-text").text(message),$tooltip.show().addClass("show"),setTimeout(()=>{$tooltip.removeClass("show"),setTimeout(()=>{$tooltip.hide()},300)},2e3)}initClipboard(){"undefined"!=typeof ClipboardJS&&(this.clipboard=new ClipboardJS(".bp-share-service-copy",{text:trigger=>$(trigger).attr("href")}),this.clipboard.on("success",e=>{this.showTooltip(bp_share_post_vars.copied_text),this.trackShare("copy",this.wrapper.data("post-id")),e.clearSelection()}))}trackVisibility(){if("IntersectionObserver"in window){let observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{entry.isIntersecting&&(this.trackImpression(),observer.disconnect())})});observer.observe(this.wrapper[0])}}trackImpression(){}handleScrollBehavior(){let lastScrollTop=0,scrollTimer=null;$(window).on("scroll",()=>{clearTimeout(scrollTimer);var scrollTop=$(window).scrollTop();scrollTop>lastScrollTop&&100<scrollTop?this.wrapper.addClass("bp-share-hidden"):this.wrapper.removeClass("bp-share-hidden"),lastScrollTop=scrollTop,scrollTimer=setTimeout(()=>{this.wrapper.removeClass("bp-share-hidden")},500)})}}$(document).ready(()=>{new BPSharePostType}),window.BPSharePostType=BPSharePostType})(jQuery);