($=>{let BPShareAdmin={init:function(){this.setupDragDrop(),this.setupColorPickers(),this.setupFormHandling(),this.setupToggleDependencies(),this.setupNotifications()},setupDragDrop:function(){$("#drag_icon_ul").length&&$("#drag_social_icon").length&&($("#drag_icon_ul").sortable({items:".socialicon",placeholder:"ui-sortable-placeholder",tolerance:"pointer",connectWith:"#drag_social_icon",cursor:"move",opacity:.8,start:function(event,ui){ui.item.addClass("sorting"),$(".no-services-message").hide(),ui.placeholder.height(ui.item.height())},stop:function(event,ui){ui.item.removeClass("sorting"),BPShareAdmin.handleServiceMove(ui.item,"enable"),BPShareAdmin.updateNoServicesMessages()},over:function(event,ui){$(this).addClass("drag-over")},out:function(event,ui){$(this).removeClass("drag-over")}}),$("#drag_social_icon").sortable({items:".socialicon",placeholder:"ui-sortable-placeholder",tolerance:"pointer",connectWith:"#drag_icon_ul",cursor:"move",opacity:.8,start:function(event,ui){ui.item.addClass("sorting"),$(".no-services-message").hide(),ui.placeholder.height(ui.item.height())},stop:function(event,ui){ui.item.removeClass("sorting"),BPShareAdmin.handleServiceMove(ui.item,"disable"),BPShareAdmin.updateNoServicesMessages()},over:function(event,ui){$(this).addClass("drag-over")},out:function(event,ui){$(this).removeClass("drag-over")}}),this.setupDragVisualFeedback())},setupDragVisualFeedback:function(){$(".enabled-services-list, .disabled-services-list").on("dragover",function(e){e.preventDefault(),$(this).addClass("drag-active")}).on("dragleave",function(e){$(this).removeClass("drag-active")}).on("drop",function(e){$(this).removeClass("drag-active")})},handleServiceMove:function($item,action){var serviceName=$item.data("service")||$item.text().trim(),isInEnabledList=0<$item.closest("#drag_icon_ul").length,$item=0<$item.closest("#drag_social_icon").length;let finalAction;if(isInEnabledList)finalAction="enable";else{if(!$item)return;finalAction="disable"}this.updateServiceStatus(serviceName,finalAction),this.updateServicesHiddenField()},updateServicesHiddenField:function(){let enabledServices={};$("#drag_icon_ul .socialicon[data-service]").each(function(){var service=$(this).data("service"),name=$(this).text().trim();service&&name&&(enabledServices[service]=name)}),$("#bp_share_services_serialized").length&&$("#bp_share_services_serialized").val(JSON.stringify(enabledServices))},updateServiceStatus:function(serviceName,action){var ajaxAction,dataField;serviceName&&(ajaxAction="enable"===action?"wss_social_icons":"wss_social_remove_icons",dataField="enable"===action?"term_name":"icon_name",this.showLoadingIndicator(serviceName,action),$.ajax({url:bp_share_admin_vars.ajax_url,type:"POST",data:{action:ajaxAction,[dataField]:serviceName,nonce:bp_share_admin_vars.nonce},timeout:1e4,success:response=>{response.success?this.showNotice(serviceName+" "+("enable"===action?"activated":"deactivated")+" successfully","success"):(this.showNotice("Failed to update network: "+(response.data?.message||"Unknown error"),"error"),this.revertServiceMove(serviceName,action))},error:(xhr,status,error)=>{let errorMessage="Network error occurred";"timeout"===status?errorMessage="Request timed out":xhr.responseJSON&&xhr.responseJSON.data&&xhr.responseJSON.data.message&&(errorMessage=xhr.responseJSON.data.message),this.showNotice(errorMessage,"error"),this.revertServiceMove(serviceName,action)},complete:()=>{this.hideLoadingIndicator(serviceName)}}))},showLoadingIndicator:function(serviceName,action){$(`.socialicon[data-service="${serviceName}"]`).addClass("updating").append('<span class="spinner"></span>')},hideLoadingIndicator:function(serviceName){$(`.socialicon[data-service="${serviceName}"]`).removeClass("updating").find(".spinner").remove()},revertServiceMove:function(serviceName,action){action="enable"===action?"#drag_social_icon":"#drag_icon_ul";$(`.socialicon[data-service="${serviceName}"]`).detach().appendTo(action),this.updateNoServicesMessages(),this.updateServicesHiddenField()},updateNoServicesMessages:function(){var $enabledList=$("#drag_icon_ul"),$enabledItems=$enabledList.find(".socialicon[data-service]");let $enabledMessage=$enabledList.find(".no-services-message");0===$enabledItems.length?(0===$enabledMessage.length&&($enabledMessage=$('<li class="no-services-message">No networks enabled. Drag networks from the inactive list to enable them.</li>'),$enabledList.append($enabledMessage)),$enabledMessage.show()):$enabledMessage.hide();$enabledItems=$("#drag_social_icon"),$enabledList=$enabledItems.find(".socialicon[data-service]");let $availableMessage=$enabledItems.find(".no-services-message");0===$enabledList.length?(0===$availableMessage.length&&($availableMessage=$('<li class="no-services-message">All networks are active. Drag networks from the active list to disable them.</li>'),$enabledItems.append($availableMessage)),$availableMessage.show()):$availableMessage.hide()},setupColorPickers:function(){$.fn.wpColorPicker&&$(".bp-share-color-picker").each(function(){var $this=$(this),defaultColor=$this.val()||$this.data("default-color")||"#667eea";$this.wpColorPicker({defaultColor:defaultColor,change:function(event,ui){ui=ui.color.toString();$(this).val(ui).trigger("change"),BPShareAdmin.showColorPreview(this,ui)},clear:function(){var defaultColor=$(this).data("default-color")||"#667eea";$(this).val(defaultColor).trigger("change"),BPShareAdmin.showColorPreview(this,defaultColor)},hide:!0,palettes:["#667eea","#764ba2","#f093fb","#4facfe","#43e97b","#38ef7d","#ffecd2","#fcb69f","#ff9a9e","#fecfef","#fccb90","#d57eeb"]})})},showColorPreview:function(element,color){0===$(element).siblings(".color-preview").length&&$(element).after('<div class="color-preview" style="width: 20px; height: 20px; border: 1px solid #ccc; margin-left: 10px; display: inline-block;"></div>'),$(element).siblings(".color-preview").css("background-color",color)},setupFormHandling:function(){$("form").on("submit",function(e){let $submitBtn=$(this).find('[type="submit"]'),originalValue=$submitBtn.val();if($submitBtn.prop("disabled"))return e.preventDefault(),!1;$submitBtn.prop("disabled",!0),$submitBtn.val(bp_share_admin_vars.strings.saving||"Saving..."),setTimeout(function(){$submitBtn.prop("disabled",!1),$submitBtn.val(originalValue)},1e4)}),$(document).on("click",".reset-settings",function(e){if(!confirm("Are you sure you want to reset all settings? This action cannot be undone."))return e.preventDefault(),!1}),this.setupAutoSave()},setupAutoSave:function(){let autoSaveTimeout;$(".auto-save").on("change input",function(){clearTimeout(autoSaveTimeout);let $field=$(this);autoSaveTimeout=setTimeout(function(){BPShareAdmin.autoSaveField($field)},2e3)})},autoSaveField:function($field){var fieldName=$field.attr("name"),$field=$field.val();fieldName&&$.ajax({url:bp_share_admin_vars.ajax_url,type:"POST",data:{action:"bp_share_auto_save",field_name:fieldName,field_value:$field,nonce:bp_share_admin_vars.nonce},success:function(response){response.success&&BPShareAdmin.showNotice("Settings auto-saved","info",2e3)}})},setupToggleDependencies:function(){$("#bp_share_services_enable").on("change",function(){var isEnabled=$(this).is(":checked");$("#logout_sharing_row").toggle(isEnabled),isEnabled||$("#bp_share_services_logout_enable").prop("checked",!1)}),$('input[name="bpas_icon_color_settings[icon_style]"]').on("change",function(){var selectedStyle=$(this).val();BPShareAdmin.updateIconStylePreview(selectedStyle)}),$("#bp_share_services_enable").trigger("change"),$('input[name="bpas_icon_color_settings[icon_style]"]:checked').trigger("change")},updateIconStylePreview:function(style){var $preview=$(".icon-style-preview");0!==$preview.length&&$preview.removeClass("circle rec blackwhite baricon").addClass(style)},setupNotifications:function(){$(".notice").each(function(){let $notice=$(this);$notice.hasClass("notice-persistent")||setTimeout(function(){$notice.fadeOut(500,function(){$(this).remove()})},5e3)}),$(document).on("click",".notice-dismiss",function(){$(this).closest(".notice").fadeOut(300,function(){$(this).remove()})}),$(document).on("click",".notice .close-button",function(e){e.preventDefault(),$(this).closest(".notice").fadeOut(300,function(){$(this).remove()})})},showNotice:function(message,type,duration){duration=duration||5e3,$(".bp-share-notice-"+(type=type||"info")).remove();let $notice=$('<div class="notice notice-'+type+" is-dismissible bp-share-notice-"+type+'"><p>'+message+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></div>');type=$(".wrap h1").first();type.length?type.after($notice):$(".wrap").prepend($notice),0<duration&&setTimeout(function(){$notice.fadeOut(function(){$(this).remove()})},duration),$notice.find(".notice-dismiss").on("click",function(){$notice.fadeOut(function(){$(this).remove()})})},showLoadingOverlay:function(message){message=message||bp_share_admin_vars.strings.loading||"Loading...",$(".bp-share-loading-overlay").length||(message=$('<div class="bp-share-loading-overlay"><div class="bp-share-loading-content"><div class="bp-share-spinner"></div><p>'+message+"</p></div></div>"),$("body").append(message),message.fadeIn(200))},hideLoadingOverlay:function(){$(".bp-share-loading-overlay").fadeOut(200,function(){$(this).remove()})},getUrlParameter:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");name=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(location.search);return null===name?"":decodeURIComponent(name[1].replace(/\+/g," "))},isValidColor:function(color){return!(!color||!/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color)&&!["red","blue","green","yellow","orange","purple","pink","brown","black","white","gray","grey"].includes(color.toLowerCase()))}};$(document).ready(function(){try{BPShareAdmin.init(),$("body").hasClass("bp-activity-share-admin")&&$("body").addClass("bp-share-admin-loaded"),setTimeout(function(){BPShareAdmin.updateNoServicesMessages()},100)}catch(error){}}),window.BPShareAdmin=BPShareAdmin})(jQuery);